<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Experimental Demo 1 - liquidGL WebGL - NaughtyDuk©</title>
    <link rel="icon" href="/assets/favicon.ico" />
    <style>
      :root {
        --bg: #f0f0f0;
        --fg: #333;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background: var(--bg);
        color: var(--fg);
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
      }
      /* ===== Single full-viewport lens ===== */
      .shape {
        position: fixed;
        top: 10vw;
        left: 10vw;
        width: calc(100vw - 20vw);
        height: calc(100svh - 20vw);
        border-radius: 2vw;
        transform: scaleX(0);
        transform-origin: center;
        will-change: transform;
        pointer-events: none;
        z-index: 9999;
      }

      .content-section {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100svh;
        padding: 0 10vw;
        position: relative;
        overflow: hidden;
        background-size: cover;
        background-position: center;
      }

      .text-section {
        background-color: #000;
      }

      .video-section {
        background-color: #111;
      }

      .banner-text-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 2rem;
      }

      .banner-text {
        width: 100%;
        text-align: center;
        font-size: 6vw;
        font-weight: 800;
        text-transform: uppercase;
        color: #ffffff;
        pointer-events: none;
        line-height: 0.85;
      }

      .banner-text.xl {
        font-size: 10vw;
        letter-spacing: -0.025em;
        text-transform: none;
        font-weight: 700;
      }

      .banner-text.sm {
        font-size: 2vw;
      }

      .banner-text.xs {
        font-size: 1vw;
        letter-spacing: 0.05em;
      }

      .banner-text.dark {
        color: #333333;
      }

      .banner-video {
        width: 100%;
        height: auto;
        object-fit: cover;
        pointer-events: none;
        border-radius: 2vw;
        max-width: 60vw;
      }

      .split {
        visibility: hidden;
      }

      .video-hover-area {
        display: inline-block;
        position: relative;
        line-height: 0;
        cursor: pointer;
      }

      /* Video Player Styles */
      .play-icon {
        position: fixed;
        width: 10vw;
        height: 10vw;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 10;
        mix-blend-mode: difference;
      }

      .fullscreen-player {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100svh;
        background: #111111;
        z-index: 99999;
      }

      .fullscreen-player.inactive .custom-controls,
      .fullscreen-player.inactive .close-btn {
        opacity: 0;
      }

      .fullscreen-player video {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .close-btn {
        position: absolute;
        top: 3vw;
        right: 3vw;
        width: 30px;
        height: 30px;
        cursor: pointer;
        z-index: 100000;
        mix-blend-mode: difference;
      }

      .close-btn:before,
      .close-btn:after {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        width: 100%;
        height: 2px;
        background: #fff;
        transform-origin: center;
      }

      .close-btn:before {
        transform: translateY(-50%) rotate(45deg);
      }

      .close-btn:after {
        transform: translateY(-50%) rotate(-45deg);
      }

      .close-btn:focus-visible {
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.7);
      }

      /* Custom Controls Container */
      .custom-controls {
        position: absolute;
        bottom: 3vw;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 800px;
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 10px 15px 10px 10px;
        border-radius: 10px;
        background: #e8e8e8;
        transition: opacity 0.4s ease;
        mix-blend-mode: exclusion;
      }

      /* Play/Pause Button */
      .play-pause-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        position: relative;
        outline: none;
        flex-shrink: 0;
      }

      /* Play icon (triangle) */
      .play-pause-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
        border-left: 14px solid #333333;
        transition: all 0.2s ease;
      }

      /* Pause icon (two bars) */
      .play-pause-btn.playing::before {
        border-style: double;
        border-width: 0 0 0 14px;
        border-color: #333333;
        height: 16px;
        width: 6px;
        border-left-style: solid;
        border-right-style: solid;
        border-left-width: 5px;
        border-right-width: 5px;
        transform: translate(-50%, -50%);
      }

      /* Progress Bar */
      .progress-bar-container {
        flex-grow: 1;
        height: 6px;
        background: #cdcdcd;
        border-radius: 3px;
        cursor: pointer;
      }

      .progress-bar-fill {
        width: 0;
        height: 100%;
        border-radius: 3px;
        background: #333333;
      }
    </style>
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/SplitText.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.19.1/dist/lil-gui.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
  </head>
  <body>
    <div class="main-content">
      <div
        class="content-section"
        style="background-image: url(/assets/liquid-bkg-_0000_Comp-33.webp)"
      >
        <div class="banner-text-container">
          <div class="banner-text sm">Introducing</div>
          <div class="banner-text xl">liquidGL</div>
          <div class="banner-text xs">
          </br></br>A real-time liquid glass effect for the web</br></br>Built with love by NaughtyDuk©
          </div>
        </div>
      </div>
      <div
        class="content-section"
      >
        <div class="video-hover-area">
          <video
            class="banner-video"
            src="/assets/liquidGlass-Full-Promo25fps-OPT.mp4"
            autoplay
            muted
            loop
            playsinline
          ></video>
        </div>
      </div>
      <div
      class="content-section"
    >
      <div class="banner-text dark split">
        LIQUIDGL EXPERIEMENTAL, FOR USE WITH VIDEO AND ANIMATIONS FOR REAL
        TIME REFRACTION.
      </div>
    </div>
      <div
      class="content-section"
      style="background-image: url(/assets/liquid-bkg-_0001_Comp-183.webp)"
    >
    </div>
      <div
        class="content-section"
        style="background-image: url(/assets/liquid-bkg-_0002_Comp-163.webp)"
      >
        <div class="banner-text split">
          LIQUIDGL EXPERIEMENTAL, FOR USE WITH VIDEO AND ANIMATIONS FOR REAL
          TIME REFRACTION.
        </div>
      </div>
      <div
        class="content-section"
        style="background-image: url(/assets/liquid-bkg-_0003_Comp-151.webp)"
      >
        <div class="banner-text split">
          THIS TEXT IS ANIMATED WITH GSAP SPLITTEXT AND REFRACTED IN REAL TIME
          AS YOU SCROLL.
        </div>
      </div>
      <div
        class="content-section"
        style="background-image: url(/assets/liquid-bkg-_0004_Comp-13.webp)"
      ></div>
    </div>

    <!-- Single lens shape -->
    <div class="shape"></div>

    <!-- Fullscreen Video Player -->
    <div class="fullscreen-player">
      <div
        class="close-btn"
        tabindex="0"
        role="button"
        aria-label="Close video player"
      ></div>
      <video src="/assets/liquidGlass-Full-Promo25fps-OPT.mp4"></video>
      <div class="custom-controls">
        <button
          class="play-pause-btn"
          role="button"
          aria-label="Play video"
        ></button>
        <div class="progress-bar-container">
          <div class="progress-bar-fill"></div>
        </div>
      </div>
    </div>
    <img src="/assets/play-icon.svg" class="play-icon" alt="Play" />

    <!-- Scripts -->
    <script src="/scripts/html2canvas.js"></script>
    <script src="/scripts/liquidGL-experimental.js"></script>
    <script>
      // GSAP SplitText Animation
      gsap.registerPlugin(SplitText);

      let glassEffect;

      document.addEventListener("DOMContentLoaded", () => {
        const fontsReady =
          document.fonts && document.fonts.ready
            ? document.fonts.ready
            : Promise.resolve();

        fontsReady.then(() => {
          /* 1. Prepare SplitText first */
          gsap.set(".split", { visibility: "visible" });
          const allSplitLines = [];

          gsap.utils.toArray(".split").forEach((splitEl) => {
            const split = SplitText.create(splitEl, {
              type: "lines",
              linesClass: "line",
              mask: "lines",
            });

            // Animate lines when the element's top reaches 50% of viewport
            gsap.from(split.lines, {
              scrollTrigger: {
                trigger: splitEl,
                start: "top 50%",
                toggleActions: "play none none reverse",
              },
              duration: 0.8,
              yPercent: 100,
              stagger: 0.1,
              ease: "expo.out",
            });

            allSplitLines.push(...split.lines);
          });

          /* 2. Init LiquidGL after SplitText so snapshot matches */
          glassEffect = LiquidGL({
            target: ".shape",
            snapshot: "body",
            resolution: 2,
            refraction: 0.026,
            bevelDepth: 0.119,
            bevelWidth: 0.057,
            frost: 0,
            specular: true,
            shadow: false,
            reveal: "fade",
            tilt: false,
            tiltFactor: 0,
            on: {
              init: function (lens) {
                gsap.to(lens.el, {
                  scaleX: 1,
                  duration: 1.2,
                  ease: "expo.out",
                });
              },
            },
          });

          /* 3. Register SplitText lines for dirty-rect updates */
          LiquidGL.registerDynamic(allSplitLines);

          console.log("liquidGL ready!", glassEffect);

          /* 4. GUI etc. */
          const lensArr = Array.isArray(glassEffect)
            ? glassEffect
            : [glassEffect];
          const gui = new lil.GUI();
          const folder = gui.addFolder("LiquidGL Effect");
          const first = lensArr[0];
          const sync = (k, v) => lensArr.forEach((ln) => (ln.options[k] = v));
          folder
            .add(first.options, "refraction", 0, 0.1, 0.001)
            .onChange((v) => sync("refraction", v));
          folder
            .add(first.options, "bevelDepth", 0, 0.2, 0.001)
            .onChange((v) => sync("bevelDepth", v));
          folder
            .add(first.options, "bevelWidth", 0, 0.5, 0.001)
            .onChange((v) => sync("bevelWidth", v));
          folder
            .add(first.options, "frost", 0, 10, 0.1)
            .onChange((v) => sync("frost", v));
          folder
            .add(first.options, "specular")
            .onChange((v) => sync("specular", v));
          folder.add(first.options, "tilt").onChange((v) => sync("tilt", v));
          folder
            .add(first.options, "tiltFactor", 0, 25, 0.1)
            .onChange((v) => sync("tiltFactor", v));
          folder
            .add(first.options, "shadow")
            .name("Shadow")
            .onChange((v) => lensArr.forEach((ln) => ln.setShadow(v)));
          folder
            .add(first.options, "reveal", ["none", "fade"])
            .name("Reveal")
            .onChange((v) => sync("reveal", v));
          folder.close();

          /* 5. Lenis + GSAP ticker sync */
          const lenis = new Lenis();
          lenis.on("scroll", ScrollTrigger.update);
          gsap.ticker.add((t) => {
            lenis.raf(t * 1000);
            if (window.glassEffect) {
            // For multi-instance build, glassEffect may be an array; call renderer directly.
            if (Array.isArray(window.glassEffect)) {
              if (window.__LiquidGLRenderer__)
                window.__LiquidGLRenderer__.render();
            } else if (!window.glassEffect.options.specular) {
              window.glassEffect.render();
            }
          }
          });
          gsap.ticker.lagSmoothing(0);
        });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Select elements without modifying existing HTML
        const videoTrigger = document.querySelector(".video-hover-area");
        const playIcon = document.querySelector(".play-icon");
        const fullscreenPlayer = document.querySelector(".fullscreen-player");
        const fullscreenVideo = fullscreenPlayer.querySelector("video");
        const closeBtn = document.querySelector(".close-btn");

        // New custom controls elements
        const customControls = document.querySelector(".custom-controls");
        const playPauseBtn = document.querySelector(".play-pause-btn");
        const progressBarContainer = document.querySelector(
          ".progress-bar-container"
        );
        const progressBarFill = document.querySelector(".progress-bar-fill");

        if (!videoTrigger) return;

        // Style the trigger to indicate it's clickable
        videoTrigger.style.cursor = "pointer";

        // --- GSAP Animations and Initial States ---
        gsap.set(playIcon, {
          scale: 0,
          autoAlpha: 0,
          xPercent: -50,
          yPercent: -50,
        });

        gsap.set(fullscreenPlayer, {
          xPercent: -100,
          visibility: "hidden",
        });

        // --- Player Logic ---
        let inactivityTimer;

        const hideControls = () => {
          if (!fullscreenVideo.paused) {
            fullscreenPlayer.classList.add("inactive");
          }
        };

        const resetInactivityTimer = () => {
          fullscreenPlayer.classList.remove("inactive");
          clearTimeout(inactivityTimer);
          inactivityTimer = setTimeout(hideControls, 3000); // Hide after 3 seconds
        };

        fullscreenPlayer.addEventListener("mousemove", resetInactivityTimer);
        fullscreenPlayer.addEventListener("touchstart", resetInactivityTimer);

        // Play/Pause
        const togglePlayPause = () => {
          if (fullscreenVideo.paused) {
            fullscreenVideo.play();
            playPauseBtn.classList.add("playing");
            playPauseBtn.setAttribute("aria-label", "Pause video");
            resetInactivityTimer();
          } else {
            fullscreenVideo.pause();
            playPauseBtn.classList.remove("playing");
            playPauseBtn.setAttribute("aria-label", "Play video");
            clearTimeout(inactivityTimer); // Keep controls visible when paused
          }
        };

        playPauseBtn.addEventListener("click", togglePlayPause);
        fullscreenVideo.addEventListener("click", (e) => {
          // Prevent video click from propagating to elements behind it
          e.stopPropagation();
          // only toggle play if the click is on the video itself, not the controls
          if (e.target === fullscreenVideo) {
            togglePlayPause();
          }
        });

        // Progress bar
        fullscreenVideo.addEventListener("timeupdate", () => {
          const progress =
            (fullscreenVideo.currentTime / fullscreenVideo.duration) * 100;
          gsap.to(progressBarFill, {
            width: `${progress}%`,
            duration: 0.1,
            ease: "linear",
          });
        });

        // Seek
        progressBarContainer.addEventListener("click", (e) => {
          const rect = progressBarContainer.getBoundingClientRect();
          const clickX = e.clientX - rect.left;
          const width = rect.width;
          const newTime = (clickX / width) * fullscreenVideo.duration;
          fullscreenVideo.currentTime = newTime;
        });

        // Reset UI when video ends
        fullscreenVideo.addEventListener("ended", () => {
          playPauseBtn.classList.remove("playing");
          playPauseBtn.setAttribute("aria-label", "Play video");
          fullscreenPlayer.classList.remove("inactive");
          clearTimeout(inactivityTimer);
        });

        // --- Event Listeners ---

        // Play icon to follow cursor over the video trigger area
        videoTrigger.addEventListener("mouseenter", () => {
          gsap.to(playIcon, { autoAlpha: 1, scale: 1, duration: 0.3 });
        });

        videoTrigger.addEventListener("mouseleave", () => {
          gsap.to(playIcon, { autoAlpha: 0, scale: 0, duration: 0.3 });
        });

        videoTrigger.addEventListener("mousemove", (e) => {
          gsap.to(playIcon, {
            x: e.clientX,
            y: e.clientY,
            duration: 0.4,
            ease: "power3.out",
          });
        });

        // Click trigger to open fullscreen video player
        videoTrigger.addEventListener("click", () => {
          gsap.to(fullscreenPlayer, {
            xPercent: 0,
            visibility: "visible",
            duration: 0.8,
            ease: "expo.inOut",
            onComplete: () => {
              fullscreenVideo.play();
              playPauseBtn.classList.add("playing");
              playPauseBtn.setAttribute("aria-label", "Pause video");
              resetInactivityTimer();
            },
          });
        });

        // --- Close logic ---
        const closePlayer = () => {
          gsap.to(fullscreenVideo, {
            volume: 0,
            duration: 0.5,
            ease: "linear",
            onComplete: () => {
              fullscreenVideo.pause();
              gsap.to(fullscreenPlayer, {
                xPercent: -100,
                duration: 0.8,
                ease: "expo.inOut",
                onComplete: () => {
                  gsap.set(fullscreenPlayer, { visibility: "hidden" });
                  fullscreenVideo.currentTime = 0;
                  fullscreenVideo.volume = 1; // Reset for next time
                  playPauseBtn.classList.remove("playing");
                  playPauseBtn.setAttribute("aria-label", "Play video");
                  gsap.set(progressBarFill, { width: "0%" });
                },
              });
            },
          });
        };

        closeBtn.addEventListener("click", closePlayer);
        closeBtn.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            closePlayer();
          }
        });
      });
    </script>
  </body>
</html>
